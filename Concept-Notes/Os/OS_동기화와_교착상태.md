## 동기화와 교착상태

---

### 동기화란?
- **여러 프로세스나 스레드가 공유 자원에 접근할 때 실행 순서와 시점을 맞추는 것**
- 데이터의 일관성을 유지하고, 예상치 못한 동작(경쟁 상태)을 방지
- 크게 2가지 목적:
  1. **실행순서제어 동기화** : 특정 작업이 끝난 후 다른 작업이 시작되도록 순서를 맞춤
  2. **상호배제를 위한 동기화** : 한 번에 하나의 프로세스만 공유 자원 사용

---

### 실행순서제어 동기화
- 예: `A` 작업이 끝난 후 `B` 작업 실행
- `signal` / `wait` 같은 동기화 신호로 순서 보장

---

### 상호배제를 위한 동기화
- 여러 프로세스가 동시에 공유 자원에 접근하지 못하게 제한
- 구현 방식: **뮤텍스, 세마포어, 모니터** 등

---

## 공유 자원과 임계 구역

### 공유 자원
- 여러 프로세스/스레드가 함께 사용하는 자원
- 예: 전역 변수, 파일, 프린터, 데이터베이스 레코드

### 임계 구역 (Critical Section)
- 공유 자원에 접근하는 코드 영역
- 동시에 둘 이상이 실행되면 **데이터 불일치** 발생 가능

---

## 레이스 컨디션 (Race Condition)
- 여러 프로세스가 **동시에 공유 자원 접근** → 실행 순서에 따라 결과가 달라지는 문제
- 예: 은행 계좌 잔액 변경 시 동시 출금 요청

---

## 생산자와 소비자 문제
- **Producer**: 데이터를 생성해서 버퍼에 넣음
- **Consumer**: 버퍼에서 데이터를 꺼내 사용
- 문제: 버퍼가 비었는데 소비자가 꺼내거나, 버퍼가 가득 찼는데 생산자가 넣으면 오류
- 해결: **동기화 기법**으로 버퍼 상태 제어

---

## 뮤텍스 락과 세마포

### 동기화 해결의 세 가지 원칙
1. **상호 배제(Mutual Exclusion)**  
   - 한 번에 하나의 프로세스만 임계 구역 실행 가능
2. **진행(Progress)**  
   - 임계 구역에 아무도 없으면, 대기 중인 프로세스가 바로 들어가야 함
3. **유한 대기(Bounded Waiting)**  
   - 특정 프로세스가 무한히 기다리지 않도록 보장

---

### 뮤텍스 락 (Mutex Lock)
- **상호 배제를 위한 가장 기본적인 도구**
- 잠금(lock)과 해제(unlock)으로 임계 구역 출입 제어
- 한 번에 한 스레드만 lock 가능

```c
acquire(lock);  // 잠금
// 임계 구역
release(lock);  // 해제
````

---

### 세마포어 (Semaphore)

* 정수 값으로 공유 자원 접근 개수를 제어하는 동기화 도구
* **이진 세마포어**: 0 또는 1 값만 가짐 (뮤텍스와 유사)
* **카운팅 세마포어**: 0 이상 정수 값, 여러 개의 자원 동시 접근 가능

```c
wait(S);  // S 값 감소, 0이면 대기
signal(S); // S 값 증가, 대기 중인 프로세스 깨움
```

---

### 모니터 (Monitor)

* 고급 동기화 도구, **언어 수준**에서 제공
* 공유 자원과 이를 다루는 메서드 + 동기화 코드가 하나의 모듈로 묶임
* 개발자가 동기화 세부 구현을 직접 안 해도 됨

---

## 교착상태 해결 방법

### 식사하는 철학자 문제

* 철학자 5명이 식탁에서 생각과 식사를 반복
* 포크 2개를 사용해야 식사 가능
* 모든 철학자가 동시에 왼쪽 포크를 집으면 오른쪽 포크를 기다리면서 **교착상태** 발생
* 해결: 포크 집는 순서 조정, 비대칭 규칙, 타임아웃 설정 등

---

### 교착 상태란?

* **둘 이상의 프로세스가 서로가 가진 자원을 기다리면서 무한 대기하는 상태**

---

### 교착 상태 발생 조건 (4가지)

1. **상호 배제(Mutual Exclusion)** : 자원은 한 번에 하나의 프로세스만 사용
2. **점유 대기(Hold and Wait)** : 자원을 가진 상태에서 다른 자원을 기다림
3. **비선점(No Preemption)** : 자원을 강제로 뺏을 수 없음
4. **원형 대기(Circular Wait)** : 프로세스들이 원형으로 서로의 자원을 기다림

---

### 교착 상태 해결 방법

1. **예방(Prevention)** : 4가지 조건 중 하나를 깨뜨려 교착상태 원천 차단
2. **회피(Avoidance)** : 교착 상태가 일어날 가능성이 있는 요청을 거절

   * 대표 알고리즘: **은행원 알고리즘(Banker's Algorithm)**
3. **검출 후 회복(Detection & Recovery)** : 교착상태를 탐지하고 프로세스를 종료하거나 자원 회수
4. **무시(Ignorance)** : 발생 확률이 낮으면 그냥 두고 시스템 재부팅 (타조 알고리즘)

---

### 교착 상태 회피 ― 은행원 알고리즘

* 모든 자원 요청을 승인하기 전에 **안전 상태**인지 검사
* 안전 상태: 모든 프로세스가 순서대로 자원을 얻고 종료할 수 있는 상태

---

### 교착 상태 검출 후 회복

* 주기적으로 자원 할당 그래프를 검사하여 교착상태 탐지
* 회복 방법: 프로세스 강제 종료, 자원 선점

---

### 교착 상태 무시 ― 타조 알고리즘

* 발생 빈도가 낮으면 그냥 무시
* 교착상태 발생 시, 관리자 개입 또는 시스템 재시작

```

