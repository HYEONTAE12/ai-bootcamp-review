# 전송 계층 (Transport Layer)

전송 계층은 **종단 간(end-to-end) 통신**을 담당하며, 프로세스(애플리케이션) 간 데이터 전송을 신뢰성 있게 관리한다. 대표적인 프로토콜은 **TCP**와 **UDP**이다.

---

## 포트 (Port)

* **정의**: 전송 계층에서 **프로세스를 식별하는 논리적 주소**.
* **크기**: 16비트 → 0 \~ 65,535까지 사용 가능.
* **작성 방식(범위 구분)**

  * **잘 알려진 포트 (Well-known Ports)**: 0 \~ 1023

    * HTTP(80), HTTPS(443), FTP(21), SSH(22) 등
  * **등록된 포트 (Registered Ports)**: 1024 \~ 49,151

    * 특정 서비스/애플리케이션이 등록해서 사용 (예: MySQL 3306, Minecraft 25565)
  * **동적/사설 포트 (Dynamic/Ephemeral Ports)**: 49,152 \~ 65,535

    * 클라이언트가 임시로 생성해서 사용 (예: 웹 브라우저 요청 시 임의 포트 사용)

---

## Netstat

* **정의**: 네트워크 연결 상태, 포트, 라우팅 테이블 등을 확인하는 명령어.
* **용도**: 현재 시스템에서 어떤 포트가 열려 있고 어떤 상태인지 확인.

  * 예: `netstat -an` → 모든 연결과 포트 표시

---

## TCP와 UDP

* **TCP (Transmission Control Protocol)**

  * 연결 지향 (Connection-oriented)
  * 신뢰성 보장 (재전송, 흐름제어, 혼잡제어)
  * 순서 보장
  * 예: 웹 브라우징(HTTP/HTTPS), 이메일(SMTP, IMAP), 파일전송(FTP)

* **UDP (User Datagram Protocol)**

  * 비연결형 (Connectionless)
  * 비신뢰성 (재전송 X, 순서 보장 X)
  * 단순하고 빠름 (오버헤드 적음)
  * 예: 실시간 스트리밍, 온라인 게임, DNS

---

## MSS (Maximum Segment Size)

* **정의**: TCP 세그먼트에서 데이터(payload)의 최대 크기.
* **특징**:

  * TCP 헤더 + IP 헤더를 제외한 순수 데이터 크기.
  * MTU(최대 전송 단위)와 관련 → 일반적으로 Ethernet 환경에서는 MSS가 1460 바이트 (MTU 1500 - IP 20 - TCP 20).

---

## TCP 세그먼트 구조

1. **출발지 포트(Source Port)**

   * 데이터를 보낸 애플리케이션 프로세스를 식별.

2. **목적지 포트(Destination Port)**

   * 데이터를 받을 애플리케이션 프로세스를 식별.

3. **순서 번호(Sequence Number)**

   * 전송 데이터 조각이 전체 스트림에서 몇 번째인지 나타냄.
   * 수신자가 올바른 순서로 재조립할 수 있도록 사용.

4. **확인 응답 번호(Acknowledgment Number)**

   * 수신자가 다음에 기대하는 순서 번호.
   * 송신자에게 “이전 데이터 잘 받았다”는 신호.

5. **제어 비트(Flags / Control Bits)**

   * 연결 제어 및 상태 표시. 주요 플래그:

     * **ACK**: 확인 응답이 유효함을 표시.
     * **SYN**: 연결 설정 요청.
     * **FIN**: 연결 종료 요청.
     * **RST**: 비정상 연결 강제 종료.

6. **윈도우 크기(Window Size)**

   * 수신자가 한 번에 받아들일 수 있는 데이터 양.
   * 흐름 제어(Flow Control)에 사용.

---

## UDP 데이터그램 구조

1. **출발지 포트(Source Port)**

   * 송신 애플리케이션 식별.

2. **목적지 포트(Destination Port)**

   * 수신 애플리케이션 식별.

3. **길이(Length)**

   * UDP 헤더 + 데이터 전체 길이.

4. **체크섬(Checksum)**

   * 오류 검출용 값. 데이터가 손상되었는지 확인.

---

## TCP 연결 과정 (Three-Way Handshake)

TCP는 연결을 수립할 때 3단계를 거친다.

1. **SYN**: 클라이언트가 서버에 연결 요청 (SYN, 시퀀스 번호 포함).
2. **SYN+ACK**: 서버가 요청 수락, SYN과 ACK 전송.
3. **ACK**: 클라이언트가 최종 확인 ACK 전송 → 연결 성립.

* **Active Open (능동 오픈)**: 클라이언트가 먼저 SYN을 보냄.
* **Passive Open (수동 오픈)**: 서버가 연결 대기 상태(LISTEN).

---

## TCP 상태 (State Transition)

1. **CLOSED**: 연결이 닫혀 있는 상태.
2. **LISTEN**: 서버가 연결 요청을 기다리는 상태.
3. **SYN-SENT**: 클라이언트가 SYN을 보내고 응답 기다림.
4. **SYN-RECEIVED**: 서버가 SYN을 받고 SYN+ACK 응답 보낸 상태.
5. **ESTABLISHED**: 연결이 성립되어 데이터 송수신 가능한 상태.
6. **FIN-WAIT-1**: 연결 종료를 위해 FIN 보낸 상태.
7. **FIN-WAIT-2**: 상대방 FIN 기다리는 상태.
8. **CLOSE-WAIT**: 상대방 FIN 받고, 나도 FIN 준비 중.
9. **CLOSING**: 서로 FIN 교환 중인 상태.
10. **LAST-ACK**: FIN 보낸 후, 마지막 ACK 기다리는 상태.
11. **TIME-WAIT**: 모든 종료 절차 끝난 뒤, 혹시 늦게 도착할 패킷을 기다리며 일정 시간 유지.

---

✅ **정리**

* 전송 계층은 포트 번호를 이용해 프로세스 간 통신을 담당.
* TCP는 신뢰성과 연결 지향성, UDP는 속도와 단순성을 특징으로 함.
* 라우터가 아닌 **호스트 간 데이터 신뢰성**을 보장하는 것이 핵심 역할.
* TCP의 세그먼트 구조와 상태 전이는 면접·시험에서 자주 나오는 핵심 주제.

---

